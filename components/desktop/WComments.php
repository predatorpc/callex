<?php
namespace app\components\desktop;


use app\models\Comments;
use app\models\CommentsActions;
use yii\base\Widget;
use yii\helpers\ArrayHelper;
use yii\helpers\Html;

class WComments  extends Widget
{
    public $client;

    public function init()
    {
        parent::init();
        if ($this->client === null) {
            $this->client = false;
        }
    }

    public function run()
    {
        parent::run(); // TODO: Change the autogenerated stub
        $template = '';
        $template .= '<form id="comments">';


        $template .= Html::hiddenInput('comment[client_id]',$this->client->id);
        /*
        $template .= '<div class="form-group">';
        $template .= Html::label('Комментарии','',['class'=>'control-label']);

        $comments = [];
        foreach (Comments::find()->where(['client_id' => $this->client->id])->orderBy('date DESC')->limit(5)->All() as $comment) {
            $comments[] = $comment->user->second_name .
                '(' . date('d.m.Y H:i:s', strtotime($comment->date)) .
                '): '.(isset($actions[$comment->action_id])?$actions[$comment->action_id]:'')
                .' - '. $comment->text;
        }

        $template .= Html::ul($comments,['id'=>'comments_list']);
        $template .= '</div>';
        */
        $template .='<div class="form-group">';
        $template .= Html::label('Действие','',['class'=>'control-label']);
        $template .= Html::dropDownList('comment[action_id]', 'null', ArrayHelper::map(CommentsActions::find()->All(),'id','name'),['prompt' => 'Выберитe..','class'=>'form-control','id'=> 'action']);
        $template .= '</div>
<div class="form-group">';
        $template .= Html::label('Комментарий','',['class'=>'control-label']);
        $template .= Html::textarea('comment[text]','',['class'=>'form-control']);
        $template .= '</div>';
        $template .= '<div class="form-group">';
        $template .=Html::submitButton('Оставить комментарий', ['class' => 'btn btn-success', "id"=>"sendcomment"]);
        $template .= '</div>';
        $template .= '</form>';


        $templateSms = '';
        $templateSms .= '<form id="sms">';
        $templateSms .= Html::hiddenInput('sms[client_id]]',$this->client->id);
        $templateSms .= '<div class="form-group">';
        $templateSms .= Html::label('Текст','',['class'=>'control-label']);
        $templateSms .= Html::input('text','sms[sms]',(isset($sms)) ? $sms : '',['class'=>'form-control']);
        $templateSms .= '</div>';
        $templateSms .= '<div class="form-group">';
        $templateSms .= Html::submitButton('Сохранить смс', ['class' => 'btn btn-warning', "id"=>"savesms"]);
        $templateSms .= Html::submitButton('Сохранить и отправить смс', ['class' => 'btn btn-warning', "id"=>"sendsms"]);
        $templateSms .= '</div></form>';

        return $template;
    }
}